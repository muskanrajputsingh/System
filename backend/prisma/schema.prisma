generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URI")
}

model User {
  id          String   @id @default(cuid())
  name        String   @unique 
  password    String
  role        String   @default("worker")
  shopId      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  workers     Worker[]
  items       Item[]
  purchases   Purchase[]
  sales       Sale[]
  expenses    Expense[]
  salaries    Salary[]
  workerFunds WorkerFund[]
}

model Worker {
  id          String       @id @default(cuid())
  userId      String
  name        String        @unique  
  phone       String
  position    String
  salary      Float
  joinDate    DateTime
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  attendances Attendance[]
  salaries    Salary[]
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workerExpenses WorkerExpense[]
}

model Attendance {
  id        String    @id @default(cuid())
  workerId  String
  date      DateTime
  checkIn   DateTime?
  checkOut  DateTime?
  status    String
  notes     String?
  createdAt DateTime  @default(now())
  worker    Worker    @relation(fields: [workerId], references: [id], onDelete: Cascade)
}

model Salary {
  id          String    @id @default(cuid())
  userId      String
  workerId    String
  month       String
  year        Int
  basicSalary Float
  overtime    Float     @default(0)
  bonus       Float     @default(0)
  deductions  Float     @default(0)
  totalSalary Float
  paidDate    DateTime?
  status      String    @default("pending")
  createdAt   DateTime  @default(now())
  worker      Worker    @relation(fields: [workerId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Item {
  id          String     @id @default(cuid())
  userId      String
  name        String
  description String?
  category    String
  unit        String
  stock       Float      @default(0)
  minStock    Float      @default(0)
  image       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  purchases   Purchase[]
  sales       Sale[]
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Purchase {
  id              String   @id @default(cuid())
  userId          String
  itemId          String
  supplierName    String
  supplierContact String?
  quantity        Float
  unitPrice       Float
  totalAmount     Float
  borrowAmount    Float?     
  paymentType     String? 
  purchaseDate    DateTime
  image           String?
  createdAt       DateTime @default(now())
  item            Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Sale {
  id              String   @id @default(cuid())
  userId          String
  itemId          String
  customerName    String
  customerContact String?
  quantity        Float
  unitPrice       Float
  totalAmount     Float
  borrowAmount    Float?     
  paymentType     String?
  saleDate        DateTime
  image           String?
  createdAt       DateTime @default(now())
  item            Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Expense {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  amount      Float
  category    String
  date        DateTime
  receipt     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WorkerFund {
  id              String   @id @default(cuid())
  shopId          String?
  ownerId         String
  givenAmount     Float
  remainingAmount Float
  givenBy         String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  owner  User   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model WorkerExpense {
  id          String   @id @default(cuid())
  workerId    String
  title       String
  amount      Float
  date        DateTime @default(now())
  createdAt   DateTime @default(now())

  worker      Worker   @relation(fields: [workerId], references: [id], onDelete: Cascade)
}

